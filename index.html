<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Cobrinha</title>

<style>
body {
    margin: 0;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

canvas {
    background: black;
    border: 3px solid lime;
    touch-action: none;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let tamanho = 20;
let cobrinha, direcao, maca, intervalo;

// Detecta mobile
function ehMobile() {
    return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
}

// Ajusta tamanho ao girar a tela
function ajustarTela() {
    let lado = Math.min(window.innerWidth, window.innerHeight) - 20;
    canvas.width = lado;
    canvas.height = lado;

    tamanho = ehMobile() ? 25 : 20;
}

window.addEventListener("resize", ajustarTela);

// Swipe (arrastar dedo)
let startX = 0;
let startY = 0;

canvas.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
});

canvas.addEventListener("touchend", e => {
    let endX = e.changedTouches[0].clientX;
    let endY = e.changedTouches[0].clientY;

    let dx = endX - startX;
    let dy = endY - startY;

    if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 0 && direcao !== "LEFT") direcao = "RIGHT";
        if (dx < 0 && direcao !== "RIGHT") direcao = "LEFT";
    } else {
        if (dy > 0 && direcao !== "UP") direcao = "DOWN";
        if (dy < 0 && direcao !== "DOWN") direcao = "UP";
    }
});

// Teclado (PC)
document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp" && direcao !== "DOWN") direcao = "UP";
    if (e.key === "ArrowDown" && direcao !== "UP") direcao = "DOWN";
    if (e.key === "ArrowLeft" && direcao !== "RIGHT") direcao = "LEFT";
    if (e.key === "ArrowRight" && direcao !== "LEFT") direcao = "RIGHT";
});

function gerarMaca() {
    return {
        x: Math.floor(Math.random() * (canvas.width / tamanho)) * tamanho,
        y: Math.floor(Math.random() * (canvas.height / tamanho)) * tamanho
    };
}

function iniciar() {
    ajustarTela();
    cobrinha = [{x: 0, y: 0}];
    direcao = "RIGHT";
    maca = gerarMaca();
    clearInterval(intervalo);
    intervalo = setInterval(loop, 120);
}

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    let head = {...cobrinha[0]};

    if (direcao === "UP") head.y -= tamanho;
    if (direcao === "DOWN") head.y += tamanho;
    if (direcao === "LEFT") head.x -= tamanho;
    if (direcao === "RIGHT") head.x += tamanho;

    if (
        head.x < 0 || head.y < 0 ||
        head.x >= canvas.width || head.y >= canvas.height ||
        cobrinha.some(p => p.x === head.x && p.y === head.y)
    ) {
        clearInterval(intervalo);
        setTimeout(() => {
            alert("Game Over ðŸ");
            iniciar();
        }, 100);
        return;
    }

    cobrinha.unshift(head);

    if (head.x === maca.x && head.y === maca.y) {
        maca = gerarMaca();
    } else {
        cobrinha.pop();
    }

    ctx.fillStyle = "red";
    ctx.fillRect(maca.x, maca.y, tamanho, tamanho);

    ctx.fillStyle = "lime";
    cobrinha.forEach(p =>
        ctx.fillRect(p.x, p.y, tamanho - 1, tamanho - 1)
    );
}

iniciar();
</script>
</body>
</html>
