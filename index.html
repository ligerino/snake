<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Cobrinha</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;           /* trava rolagem */
    touch-action: none;         /* trava gestos do navegador */
    background: #111;
}

body {
    display: flex;
    justify-content: center;
    align-items: center;
}

canvas {
    background: black;
    border: 3px solid lime;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let tamanho;
let cobrinha, direcao, maca, intervalo;

// Ajusta tela para qualquer rota√ß√£o
function ajustarTela() {
    const margem = 10;
    const largura = window.innerWidth - margem;
    const altura = window.innerHeight - margem;
    const lado = Math.min(largura, altura);

    canvas.width = lado;
    canvas.height = lado;

    tamanho = lado < 400 ? 25 : 20;
}

window.addEventListener("resize", () => {
    clearInterval(intervalo);
    iniciar();
});

// Swipe com mais sensibilidade
let startX = 0;
let startY = 0;
const sensibilidade = 20; // quanto menor, mais sens√≠vel

canvas.addEventListener("touchstart", e => {
    e.preventDefault();
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
}, { passive: false });

canvas.addEventListener("touchend", e => {
    e.preventDefault();

    const endX = e.changedTouches[0].clientX;
    const endY = e.changedTouches[0].clientY;

    const dx = endX - startX;
    const dy = endY - startY;

    if (Math.abs(dx) < sensibilidade && Math.abs(dy) < sensibilidade) return;

    if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 0 && direcao !== "LEFT") direcao = "RIGHT";
        if (dx < 0 && direcao !== "RIGHT") direcao = "LEFT";
    } else {
        if (dy > 0 && direcao !== "UP") direcao = "DOWN";
        if (dy < 0 && direcao !== "DOWN") direcao = "UP";
    }
}, { passive: false });

// Teclado (PC)
document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp" && direcao !== "DOWN") direcao = "UP";
    if (e.key === "ArrowDown" && direcao !== "UP") direcao = "DOWN";
    if (e.key === "ArrowLeft" && direcao !== "RIGHT") direcao = "LEFT";
    if (e.key === "ArrowRight" && direcao !== "LEFT") direcao = "RIGHT";
});

function gerarMaca() {
    return {
        x: Math.floor(Math.random() * (canvas.width / tamanho)) * tamanho,
        y: Math.floor(Math.random() * (canvas.height / tamanho)) * tamanho
    };
}

function iniciar() {
    ajustarTela();
    cobrinha = [{ x: 0, y: 0 }];
    direcao = "RIGHT";
    maca = gerarMaca();
    clearInterval(intervalo);
    intervalo = setInterval(loop, 120);
}

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const head = { ...cobrinha[0] };

    if (direcao === "UP") head.y -= tamanho;
    if (direcao === "DOWN") head.y += tamanho;
    if (direcao === "LEFT") head.x -= tamanho;
    if (direcao === "RIGHT") head.x += tamanho;

    if (
        head.x < 0 || head.y < 0 ||
        head.x >= canvas.width || head.y >= canvas.height ||
        cobrinha.some(p => p.x === head.x && p.y === head.y)
    ) {
        clearInterval(intervalo);
        setTimeout(() => {
            alert("Game Over üêç");
            iniciar();
        }, 100);
        return;
    }

    cobrinha.unshift(head);

    if (head.x === maca.x && head.y === maca.y) {
        maca = gerarMaca();
    } else {
        cobrinha.pop();
    }

    ctx.fillStyle = "red";
    ctx.fillRect(maca.x, maca.y, tamanho, tamanho);

    ctx.fillStyle = "lime";
    cobrinha.forEach(p =>
        ctx.fillRect(p.x, p.y, tamanho - 1, tamanho - 1)
    );
}

iniciar();
</script>
</body>
</html>
